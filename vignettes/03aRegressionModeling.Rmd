---
title: "Part 3a - Regression Modeling"
author: "Andreas SchÃ¼ttler"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
    %\VignetteIndexEntry{Part 3a - Regression Modeling}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
    collapse = TRUE,
    comment = "#>"
)
```

The package `toxprofileR` mainly builds on the packages `limma`, `kohonen` and `hydromad` to supply functions for creating dynamic toxicogenomic fingerprints. The package currently only works with data from Agilent based zebrafish microarrays designed by Oaklabs.

This vignette describes how two different 3D-regression models can be fit to toxicogenomic datasets projected on the toxicogenomic universe (i.e., clustered by a self-organizing map algorithm)

First we load the logFC data (see `Part 1- Loading and preprocessing microarray data` on how to retrieve logFC data from raw microarray data) and find extrema for each node.

## Find extrema

```{r extrema}

library("toxprofileR")

for(substance in c("diuron","diclofenac","naproxen")){
    
    load(file = paste0("./data/",substance,"/data_logfc_",substance,".Rd"))
    
}

dslist <- list(data_diuron_logFC,
               data_diclofenac_logFC,
               data_naproxen_logFC)
    
extrema <- toxprofileR::get_extrema_nodes(dslist)
    
save(extrema, file = "./data/all/node_extrema.Rd")
    
```

```{r model fitting}

for(substance in c("diuron","diclofenac","naproxen")){

assign(x = paste0("tcta_paramframe_som_",substance), 
       value = toxprofileR::fit_tcta(elist = get(paste("data",substance,"logFC",sep="_")),
                                     extrema = extrema,
                                     cluster = FALSE))

save(list = paste0("tcta_paramframe_som_",substance), file = paste("./data/",substance,"/tcta_",substance,".Rd",sep=""))
}
```

##Session Info
```{r session info, echo=FALSE}
devtools::session_info()
```
